# Get OS X Software Updates, and update installed Ruby gems, Homebrew, npm, and their installed packages
function update() {
  echo 'OS X’s system software update tool will ask for your password...'
  sudo softwareupdate -i -a

  update_brew
  update_nvm
  update_npm
  update_gems
  rbenv rehash

  printf '\nFinished updating.\n'
  printf 'Remember to scan the install logs ^^^ for warnings and post-update instructions.\n'
}

function update_brew() {
  brew update # Run brew update twice because that's what Homebrew says to do:
  brew update # https://github.com/Homebrew/brew/blob/master/docs/README.md#troubleshooting
  brew prune
  brew cleanup
  brew cask cleanup
  brew doctor
  brew cask doctor
  brew upgrade
  brew cleanup
  brew doctor
}

function update_nvm() {
  echo 'Updating NVM'

  (
    cd "$NVM_DIR"
    git fetch origin
    git checkout `git describe --abbrev=0 --tags --match "v[0-9]*" origin`
  ) && . "$NVM_DIR/nvm.sh"
}

function update_npm() {
  echo 'Updating NPM'
  npm install -g npm # Update NPM

  echo 'Updating all globally installed packages'
  npm update -g
}

function update_gems() {
  GEM_LOCATION=$(which gem)
  if [ GEM_LOCATION == '/usr/bin/gem' ]
    then
      echo 'You’re using system Ruby — skipping update of RubyGems.'
    else
      echo 'Updating gem — the RubyGems program'
      gem update --system

      echo 'Updating all gems'
      gem update
  fi
}
